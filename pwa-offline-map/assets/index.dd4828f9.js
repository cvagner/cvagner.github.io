import{v as G,n as k,G as C,F as h,S as x,C as O,a as P,b as R,P as j,V as M,c as V,M as N,d as U,f as W,g as F,e as A,W as z,h as B,T as Z}from"./vendor.60b225a2.js";function re(){import("data:text/javascript,")}const _=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}};_();function H(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:c,onRegistered:o,onRegisterError:i}=e;let r,d;const S=async(a=!0)=>{a&&(r==null||r.addEventListener("controlling",T=>{T.isUpdate&&window.location.reload()})),d&&d.waiting&&await k(d.waiting,{type:"SKIP_WAITING"})};if("serviceWorker"in navigator){r=new G("./sw.js",{scope:"./",type:"classic"}),r.addEventListener("activated",a=>{a.isUpdate||c==null||c()});{const a=()=>{n==null||n()};r.addEventListener("waiting",a),r.addEventListener("externalwaiting",a)}r.register({immediate:t}).then(a=>{d=a,o==null||o(a)}).catch(a=>{i==null||i(a)})}return S}async function q(e,t){caches.match(t,{cacheName:"orthophotos"}).then(n=>{if(!(n!=null&&n.blob)){e.getImage().src=t;return}n.blob().then(c=>{const o=URL.createObjectURL(c);e.getImage().onload=()=>URL.revokeObjectURL(o),e.getImage().src=o})})}function D(){caches.delete("orthophotos")}function K(e,t,n){let c=[],o=n.getTileGrid().getMaxZoom();for(let i=Math.floor(t);i<=o;i++)n.getTileGrid().forEachTileCoord(e,parseInt(i),r=>c.push(n.getTileUrlFunction()(r)));return c}let w=100,y=1;async function Y(e){return Math.ceil(e.length/w)*y}async function $(e){for(;;){let t=e.splice(0,w);if(t.length<=0)break;J(t),await Q(y*1e3)}}async function J(e){await(await window.caches.open("orthophotos")).addAll(e)}function Q(e){return new Promise(t=>setTimeout(t,e))}let s,m,g,l;function X(e){l=e,s=new C({trackingOptions:{enableHighAccuracy:!0},projection:l.getView().getProjection()}),s.on("error",t=>console.log(t.message)),m=new h,s.on("change:accuracyGeometry",function(){m.setGeometry(s.getAccuracyGeometry())}),g=new h,g.setStyle(new x({image:new O({radius:6,fill:new P({color:"#3399CC"}),stroke:new R({color:"#fff",width:2})})})),s.on("change:position",function(){const t=s.getPosition();g.setGeometry(t?new j(t):null)}),new M({map:l,source:new V({features:[m,g]})})}function v(e){s.setTracking(e)}function b(){let e=s.getPosition();if(e){l.getView().setCenter(e);let t=l.getView().getZoom();l.getView().setZoom(Math.max(t,16))}else s.once("change:position",()=>b()),v(!0)}const ee=H({onNeedRefresh(){confirm("Une version plus r\xE9cente de l'application est disponible. Recharger ?")&&ee()},onOfflineReady(){alert("L'application est pr\xEAte \xE0 fonctionner sans r\xE9seau.")}});document.querySelector("#app").innerHTML=`
  <h1>Photographies a\xE9riennes <span id="status"></span></h1>
  <div class="toolbar">
    <button id="load-cache" title="du niveau de zoom courant au plus grand">\u2605 Conserver l'\xE9tendue</button>
    <button id="clear-cache">\u2606 Vider le cache</button>
    <button id="goto-dijon">\u2771 Dijon</button>

    <button id="position"><span id="positionIcon">\u2715</span> Suivre position</button>
    <button id="center-position">\u2022 Centrer</button>
  </div>
  <div id="map" class="map"></div>
`;document.getElementById("load-cache").onclick=function(){let e=u.getView().calculateExtent(u.getSize()),t=u.getView().getZoom();if(t<15){alert("Un nombre trop important de tuiles serait mis en cache \xE0 cette \xE9chelle. Veuillez zoomer");return}let n=K(e,t,E);n.length>200&&!confirm(n.length+" tuiles seront mises en cache ("+Y(n)+" sec avec la fibre environ). Continuer ?")||$(n)};document.getElementById("clear-cache").onclick=D;document.getElementById("goto-dijon").onclick=function(){let e=[561156.3584244443,5998685964885023e-9,561713.7014265041,5998807655496827e-9];u.getView().fit(e)};let f=!1,te=document.getElementById("positionIcon");document.getElementById("position").onclick=function(){f=!f,v(f),te.innerText=f?"\u2713":"\u2715"};document.getElementById("center-position").onclick=b;window.addEventListener("online",p);window.addEventListener("offline",p);function p(){let e=document.getElementById("status");e&&(e.innerText=navigator.onLine?"\u26A1":"\u{1F4A4}")}p();const u=new N({target:"map",view:new U({zoom:5,center:W([5,45])})}),I=[],L=[],oe=F("EPSG:3857"),ne=A(oe.getExtent())/256;for(let e=0;e<20;e++)L[e]=e.toString(),I[e]=ne/Math.pow(2,e);const ie=new z({origin:[-20037508,20037508],resolutions:I,matrixIds:L}),E=new B({url:"https://wxs.ign.fr/essentiels/geoportail/wmts",layer:"ORTHOIMAGERY.ORTHOPHOTOS",matrixSet:"PM",format:"image/jpeg",projection:"EPSG:3857",tileGrid:ie,style:"normal",attributions:`<a href="https://www.ign.fr/" target="_blank"><img src="https://wxs.ign.fr/static/logos/IGN/IGN.gif" title="Institut national de l'information g\xE9ographique et foresti\xE8re" alt="IGN"></a>`,tileLoadFunction:q});u.addLayer(new Z({source:E}));X(u);export{re as __vite_legacy_guard};
