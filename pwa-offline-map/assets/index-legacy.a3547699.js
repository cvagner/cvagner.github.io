!function(){function e(e,t,o,n,i,r,a){try{var l=e[r](a),s=l.value}catch(c){return void o(c)}l.done?t(s):Promise.resolve(s).then(n,i)}function t(t){return function(){var o=this,n=arguments;return new Promise((function(i,r){var a=t.apply(o,n);function l(t){e(a,i,r,l,s,"next",t)}function s(t){e(a,i,r,l,s,"throw",t)}l(void 0)}))}}var o=document.createElement("style");o.innerHTML='.ol-box{box-sizing:border-box;border-radius:2px;border:1.5px solid rgb(179,197,219);background-color:rgba(255,255,255,.4)}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:rgba(0,60,136,.3);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid #eee;border-top:none;color:#eee;font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar{position:absolute;bottom:8px;left:8px}.ol-scale-step-marker{width:1px;height:15px;background-color:#000;float:right;z-index:10}.ol-scale-step-text{position:absolute;bottom:-5px;font-size:12px;z-index:11;color:#000;text-shadow:-2px 0 #FFFFFF,0 2px #FFFFFF,2px 0 #FFFFFF,0 -2px #FFFFFF}.ol-scale-text{position:absolute;font-size:14px;text-align:center;bottom:25px;color:#000;text-shadow:-2px 0 #FFFFFF,0 2px #FFFFFF,2px 0 #FFFFFF,0 -2px #FFFFFF}.ol-scale-singlebar{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid black}.ol-unsupported{display:none}.ol-viewport,.ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.ol-viewport canvas{all:unset}.ol-selectable{-webkit-touch-callout:default;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}.ol-grabbing{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.ol-grab{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.ol-control{position:absolute;background-color:rgba(255,255,255,.4);border-radius:4px;padding:2px}.ol-control:hover{background-color:rgba(255,255,255,.6)}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}.ol-control button{display:block;margin:1px;padding:0;color:#fff;font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:rgba(0,60,136,.5);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;font-size:1.2em;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:hover,.ol-control button:focus{text-decoration:none;background-color:rgba(0,60,136,.7)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution a{color:rgba(0,60,136,.7);text-decoration:none}.ol-attribution ul{margin:0;padding:1px .5em;color:#000;text-shadow:0 0 2px #fff;font-size:12px}.ol-attribution li{display:inline;list-style:none}.ol-attribution li:not(:last-child):after{content:" "}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button{flex-shrink:0}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution:not(.ol-collapsed){background:rgba(255,255,255,.8)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:block}.ol-overviewmap .ol-overviewmap-map{border:1px solid #7b98bc;height:150px;margin:2px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:2px;left:2px;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:rgba(255,255,255,.8)}.ol-overviewmap-box{border:2px dotted rgba(0,60,136,.7)}.ol-overviewmap .ol-overviewmap-box:hover{cursor:move}body{font-family:Avenir,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-align:center;color:#2c3e50}h1{font-size:1.5em;margin-block:.3em}.map{width:100%;height:400px}.toolbar{margin-bottom:10px}.toolbar button{margin-top:4px;line-height:2em}.uploadfile{width:.1px;height:.1px;opacity:0;overflow:hidden;position:absolute;z-index:-1}\n',document.head.appendChild(o),System.register(["./vendor-legacy.39b68ae2.js"],(function(){"use strict";var e,o,n,i,r,a,l,s,c,u,d,p,m,g,b,f,h,v,x,w,y,F,k;return{setters:[function(t){e=t.v,o=t.n,n=t.G,i=t.F,r=t.S,a=t.C,l=t.a,s=t.b,c=t.P,u=t.V,d=t.c,p=t.D,m=t.f,g=t.d,b=t.e,f=t.M,h=t.g,v=t.h,x=t.i,w=t.j,y=t.W,F=t.k,k=t.T}],execute:function(){var z,E;function C(e){E.setTracking(e)}function T(){return(T=t(regeneratorRuntime.mark((function e(t,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:caches.match(o,{cacheName:"orthophotos"}).then((function(e){null!=e&&e.blob?e.blob().then((function(e){var o=URL.createObjectURL(e);t.getImage().onload=function(){return URL.revokeObjectURL(o)},t.getImage().src=o})):t.getImage().src=o}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(){caches.delete("orthophotos")}function I(e){return 1*Math.ceil(e.length/100)}function G(e){return L.apply(this,arguments)}function L(){return(L=t(regeneratorRuntime.mark((function e(t){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((o=t.splice(0,100)).length<=0)){e.next=4;break}return e.abrupt("break",9);case 4:return V(o),e.next=7,j(1e3);case 7:e.next=0;break;case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){return A.apply(this,arguments)}function A(){return(A=t(regeneratorRuntime.mark((function e(t){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.caches.open("orthophotos");case 2:return o=e.sent,e.next=5,o.addAll(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return new Promise((function(t){return setTimeout(t,e)}))}var M,P;function S(e,t,o){for(var n=[],r=e.getExtent(),a=o.getTileGrid().getMaxZoom(),l=Math.min(a,Math.floor(t));l<=a;l++)o.getTileGrid().forEachTileCoord(r,parseInt(l),(function(t){var r=o.getTileGrid().getTileCoordExtent(t),a=m(r);e.intersectsExtent(a.getExtent())&&n.push(new i({geometry:a,tileUrl:o.getTileUrlFunction()(t)}))}));return n}var U=function(){var n,i,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.immediate,l=void 0!==a&&a,s=r.onNeedRefresh,c=r.onOfflineReady,u=r.onRegistered,d=r.onRegisterError,p=function(){var e=t(regeneratorRuntime.mark((function e(){var t=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((!(t.length>0&&void 0!==t[0])||t[0])&&(null==n||n.addEventListener("controlling",(function(e){e.isUpdate&&window.location.reload()}))),!i||!i.waiting){e.next=5;break}return e.next=5,o(i.waiting,{type:"SKIP_WAITING"});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();if("serviceWorker"in navigator){(n=new e("./sw.js",{scope:"./",type:"classic"})).addEventListener("activated",(function(e){e.isUpdate||null==c||c()}));var m=function(){null==s||s()};n.addEventListener("waiting",m),n.addEventListener("externalwaiting",m),n.register({immediate:l}).then((function(e){i=e,null==u||u(e)})).catch((function(e){null==d||d(e)}))}return p}({onNeedRefresh:function(){confirm("Une version plus récente de l'application est disponible. Recharger ?")&&U()},onOfflineReady:function(){alert("L'application est prête à fonctionner sans réseau.")}});document.querySelector("#app").innerHTML='\n  <h1>Photographies aériennes <span id="status"></span></h1>\n  <div class="toolbar">\n    <span>Position</span>\n    <button id="position" title="Suivre la position"><span id="positionIcon">✕</span> Suivre</button>\n    <button id="center-position" title="Centrer sur la position">⌖ Centrer</button>\n    <button id="goto-dijon" title="Dijon">🦉 Dijon</button>\n  </div>\n  <div id="map" class="map"></div>\n',document.getElementById("goto-dijon").onclick=function(){B.getView().fit([561156.3584244443,5998685.964885023,561713.7014265041,5998807.655496827])};var N=!1,O=document.getElementById("positionIcon");function Z(){var e=document.getElementById("status");e&&(e.innerText=navigator.onLine?"⚡":"💤")}document.getElementById("position").onclick=function(){C(N=!N),O.innerText=N?"✓":"✕"},document.getElementById("center-position").onclick=function e(){var t=E.getPosition();if(t){z.getView().setCenter(t);var o=z.getView().getZoom();z.getView().setZoom(Math.max(o,16))}else E.once("change:position",(function(){return e()})),C(!0)},window.addEventListener("online",Z),window.addEventListener("offline",Z),Z();for(var B=new f({target:"map",view:new h({zoom:5,center:v([5,45])})}),H=[],D=[],W=x("EPSG:3857"),q=w(W.getExtent())/256,_=0;_<20;_++)D[_]=_.toString(),H[_]=q/Math.pow(2,_);var J=new y({origin:[-20037508,20037508],resolutions:H,matrixIds:D}),K=new F({url:"https://data.geopf.fr/wmts",layer:"ORTHOIMAGERY.ORTHOPHOTOS",matrixSet:"PM",format:"image/jpeg",projection:"EPSG:3857",tileGrid:J,style:"normal",attributions:'<a href="https://www.ign.fr/" target="_blank"><img src="https://wxs.ign.fr/static/logos/IGN/IGN.gif" title="Institut national de l\'information géographique et forestière" alt="IGN"></a>',tileLoadFunction:function(e,t){return T.apply(this,arguments)}});B.addLayer(new k({source:K})),function(e){(E=new n({trackingOptions:{enableHighAccuracy:!0},projection:(z=e).getView().getProjection()})).on("error",(function(e){return console.log(e.message)}));var t=new i;E.on("change:accuracyGeometry",(function(){t.setGeometry(E.getAccuracyGeometry())}));var o=new i;o.setStyle(new r({image:new a({radius:6,fill:new l({color:"#3399CC"}),stroke:new s({color:"#fff",width:2})})})),E.on("change:position",(function(){var e=E.getPosition();o.setGeometry(e?new c(e):null)})),new u({map:z,source:new d({features:[t,o]})})}(B);var Y=document.getElementsByClassName("toolbar")[0];Y.appendChild(document.createElement("br")),function(e,t){var o=document.getElementsByClassName("toolbar")[0],n=document.createElement("span");n.textContent="Cache ",o.appendChild(n);var i=document.createElement("button");i.id="load-cache",i.title="du niveau de zoom courant au plus grand",i.textContent="★ Carte",o.appendChild(i),i.onclick=function(){var o=e.getView().calculateExtent(e.getSize()),n=e.getView().getZoom();if(n<15)alert("Un nombre trop important de tuiles serait mis en cache à cette échelle. Veuillez zoomer");else{var i=function(e,t,o){for(var n=[],i=o.getTileGrid().getMaxZoom(),r=Math.min(i,Math.floor(t));r<=i;r++)o.getTileGrid().forEachTileCoord(e,parseInt(r),(function(e){return n.push(o.getTileUrlFunction()(e))}));return n}(o,n,t);i.length<=0||!confirm(i.length+" tuiles seront mises en cache ("+I(i)+" sec avec la fibre environ). Continuer ?")||G(i)}};var r=document.createElement("button");r.id="clear-cache",r.title="le cache de tuiles",r.textContent="☆ Vider",r.onclick=R,o.appendChild(r)}(B,K);var Q=document.createElement("span");Q.textContent=" | ",Y.appendChild(Q),function(e,t){M=e,P=new d,M.addLayer(new u({source:P}));var o=new p({type:"LineString",stopClick:!0});o.setActive(!1),M.addInteraction(o),o.on("drawend",(function(e){o.setActive(!1);var n=e.feature.getGeometry(),i=M.getView().getZoom();if(i<10)alert("Un nombre trop important de tuiles serait mis en cache à cette échelle. Veuillez zoomer");else{var r=S(n,i,t);P.addFeatures(r)}})),function(e){var t=document.getElementsByClassName("toolbar")[0],o=document.createElement("input");o.setAttribute("type","file"),o.setAttribute("id","uploadfile"),o.setAttribute("class","uploadfile"),o.setAttribute("accept",".geojson"),t.appendChild(o);var n=document.createElement("label");n.setAttribute("for","uploadfile"),n.setAttribute("title","Téléverser un fichier geojson"),n.innerHTML="&nbsp;&nbsp;↥&nbsp;&nbsp;";var i=document.createElement("button");t.appendChild(i),i.appendChild(n),o.addEventListener("change",(function(t){var o=t.target.files[0];if(o){P.clear();var n=new FileReader;n.onload=function(t){var o=JSON.parse(t.target.result),n=(new g).readFeatures(o).map((function(e){return e.getGeometry()})),i=new b(n),r=i.getExtent();M.getView().fit(r,{duration:.2});var a=S(i,M.getView().getZoom(),e);P.addFeatures(a)},n.readAsText(o)}}))}(t);var n=document.getElementsByClassName("toolbar")[0],i=document.createElement("button");i.id="load-cache-intersecting",i.title="une ligne pour identifier les tuiles à conserver",i.textContent="✐ Dessiner",i.onclick=function(){M.getView().getZoom()<10?alert("Un nombre trop important de tuiles serait mis en cache à cette échelle. Veuillez zoomer"):(o.setActive(!0),P.clear())},n.appendChild(i);var r,a=document.createElement("button");a.id="load-cache-intersecting",a.title="les tuiles identifiées",a.textContent="★ Conserver",a.onclick=function(){var e=P.getFeatures();e.length<=0||!confirm(e.length+" tuiles seront mises en cache ("+I(e)+" sec avec la fibre environ). Continuer ?")||(G(function(e){return e.map((function(e){return e.getProperties().tileUrl}))}(e)),P.clear())},n.appendChild(a),M.getView().on("change:resolution",(function(e){var t=M.getView().getZoom();a.disabled=i.disabled=t<10})),r=M.getView().getZoom(),a.disabled=i.disabled=r<10}(B,K)}}}))}();
